<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gastos de Viaje | @CaraColaViajes</title>
  <style>
    :root {
      --red: #af1a25;
      --red-dark: #8b151e;
      --glass: rgba(255,255,255,0.08);
      --text: #ffffff;
      --border: rgba(255,255,255,0.2);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background: linear-gradient(135deg, var(--red) 0%, var(--red-dark) 100%);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      padding: 20px 10px;
    }
    .container { max-width: 460px; margin: 0 auto; }
    h1 { font-size: 2.6rem; text-align:center; margin-bottom:8px; font-weight:900; }
    .by { text-align:center; font-size:1.4rem; margin-bottom:30px; opacity:0.9; }
    .slide { background: var(--glass); backdrop-filter: blur(14px); border-radius: 24px; padding: 32px; border: 1px solid var(--border); box-shadow: 0 10px 40px rgba(0,0,0,0.4); display: none; }
    .slide.active { display: block; animation: fade 0.4s; }
    @keyframes fade { from {opacity:0; transform:translateY(20px)} to {opacity:1; transform:none} }
    input, button { width: 100%; padding: 16px; margin: 12px 0; background: rgba(255,255,255,0.12); border: 1px solid var(--border); border-radius: 14px; color: white; font-size:1.1rem; }
    input[type="range"] { height: 50px; }
    input:focus { outline: 2px solid white; }
    label { font-size:1.1rem; margin-top:16px; display:block; }
    .result { font-size:2rem; font-weight:900; text-align:center; margin:24px 0; }
    .value { font-size:3rem; font-weight:900; color:white; }
    .btn { background: white; color: var(--red); font-weight:900; cursor:pointer; margin-top:30px; transition:0.3s; }
    .btn:hover { transform:scale(1.04); }
    .btn-prev { background: transparent; border:2px solid white; color:white; margin-top:10px; }
    .grid { display:grid; grid-template-columns:1fr 1fr; gap:14px; }
    .category-item { background:rgba(255,255,255,0.08); padding:18px; border-radius:16px; margin:12px 0; text-align:center; cursor:pointer; border:1px solid var(--border); }
    .category-item.fixed { opacity:0.7; cursor:default; }
  </style>
</head>
<body>
<div class="container">
  <h1>Gastos de Viaje</h1>
  <div class="by">by @CaraColaViajes</div>

  <!-- SLIDE 1: Datos básicos -->
  <div class="slide active" id="slide1">
    <label>Nombre del viaje</label>
    <input type="text" id="nombreViaje" placeholder="Ej: Ruta por Andalucía">

    <label>Fecha inicio</label>
    <input type="date" id="fechaInicio">
    <label>Fecha fin</label>
    <input type="date" id="fechaFin">

    <div class="result">Días totales: <span id="totalDias">0</span></div>

    <button class="btn" onclick="go(2)">Siguiente →</button>
  </div>

  <!-- SLIDE 2: Combustible -->
  <div class="slide" id="slide2">
    <label>Kilómetros totales</label>
    <input type="number" id="km" placeholder="Ej: 1800">

    <div class="grid">
      <div><label>Precio gasoil (€/L)</label><input type="number" step="0.001" id="precioGasoil" value="1.55"></div>
      <div><label>Consumo L/100 km</label><input type="number" step="0.1" id="consumo100" value="9.5"></div>
    </div>

    <div class="result">Gasoil: <span id="gasoilCoste">0</span>€</div>

    <button class="btn-prev" onclick="go(1)">← Anterior</button>
    <button class="btn" onclick="go(3)">Siguiente →</button>
  </div>

  <!-- SLIDE 3: Selección de categorías -->
  <div class="slide" id="slide3">
    <h2 style="text-align:center;margin-bottom:20px">Elige y ajusta tus gastos</h2>
    <div id="listaCategorias"></div>

    <button class="btn-prev" onclick="go(2)">← Anterior</button>
    <button class="btn" onclick="go(4)">Ver resumen →</button>
  </div>

  <!-- SLIDE 4: Resumen final -->
  <div class="slide" id="slide4">
    <div id="resumenFinal"></div>
    <button class="btn-prev" onclick="go(3)">← Editar gastos</button>
    <button class="btn" id="copy">COPIAR RESUMEN</button>
  </div>

  <!-- SLIDE oculto para edición con slider -->
  <div class="slide" id="slideEditor">
    <div style="text-align:center">
      <h2 id="editTitle"></h2>
      <div class="value" id="editValue">0€</div>
      <input type="range" min="0" max="200" value="0" id="slider">
      <input type="number" id="sliderInput" style="margin-top:20px">
      <small>Por día × <span id="diasEdit">0</span> días = <span id="totalCat">0</span>€</small>
    </div>
    <button class="btn-prev" onclick="guardarYVolver()">Guardar y volver</button>
  </div>
</div>

<script>
  const data = JSON.parse(localStorage.getItem('caracolaV5')) || {
    nombre:"", inicio:"", fin:"", days:1, km:0, precioGasoil:1.55, consumo100:9.5,
    items: [
      {name:"Gasolina (auto) ⛽", amount:0, fixed:true},
      {name:"Peajes y viñetas", amountPerDay:30},
      {name:"Campings / Áreas", amountPerDay:25},
      {name:"Comida diaria en supermercado", amountPerDay:25},
      {name:"Bares y restaurantes", amountPerDay:15},
      {name:"Actividades y entradas", amountPerDay:10},
      {name:"Parking y lavandería", amountPerDay:5},
      {name:"Otros / imprevistos", amountPerDay:10}
    ]
  };

  let editIndex = -1;

  function go(n) {
    document.querySelectorAll('.slide').forEach(s=>s.classList.remove('active'));
    document.getElementById('slide'+n).classList.add('active');
    if (n===3) renderLista();
    if (n===4) renderResumen();
  }

  function calcDias() {
    const i = document.getElementById('fechaInicio').value;
    const f = document.getElementById('fechaFin').value;
    if (i && f) {
      const dias = Math.round((new Date(f) - new Date(i)) / 86400000) + 1;
      data.days = dias > 0 ? dias : 1;
      document.getElementById('totalDias').textContent = data.days;
    }
    save();
  }

  function calcGasoil() {
    const km = +document.getElementById('km').value || 0;
    const p = +document.getElementById('precioGasoil').value || 0;
    const c = +document.getElementById('consumo100').value || 0;
    const coste = (km * c / 100) * p;
    data.items[0].amount = coste;
    document.getElementById('gasoilCoste').textContent = coste.toFixed(0);
    save();
  }

  function renderLista() {
    const cont = document.getElementById('listaCategorias');
    cont.innerHTML = '';
    data.items.forEach((it,i)=>{
      if (it.fixed) {
        cont.innerHTML += `<div class="category-item fixed">${it.name}<br><b>${it.amount.toFixed(0)}€</b></div>`;
      } else {
        const total = it.amountPerDay * data.days;
        cont.innerHTML += `<div class="category-item" onclick="editar(${i})">${it.name}<br><b>${it.amountPerDay}€/día → ${total.toFixed(0)}€ total</b></div>`;
      }
    });
  }

  window.editar = i => {
    editIndex = i;
    const it = data.items[i];
    document.getElementById('editTitle').textContent = it.name;
    document.getElementById('slider').value = it.amountPerDay;
    document.getElementById('sliderInput').value = it.amountPerDay;
    document.getElementById('editValue').textContent = it.amountPerDay + '€';
    document.getElementById('diasEdit').textContent = data.days;
    document.getElementById('totalCat').textContent = (it.amountPerDay * data.days).toFixed(0);
    go('Editor');
  };

  function guardarYVolver() {
    const val = +document.getElementById('slider').value;
    data.items[editIndex].amountPerDay = val;
    save();
    renderLista();
    go(3);
  }

  function renderResumen() {
    let html = `<h2 style="text-align:center">${data.nombre||'Mi viaje'}</h2>`;
    html += `<p style="text-align:center">${data.inicio} → ${data.fin} · ${data.days} días · ${data.km||0} km</p><hr style="border-color:rgba(255,255,255,0.3);margin:20px 0">`;
    let total = 0;
    data.items.forEach(it=>{
      const amt = it.fixed ? it.amount : it.amountPerDay * data.days;
      html += `<div style="display:flex;justify-content:space-between;font-size:1.3rem;margin:12px 0"><span>${it.name}</span><span>${amt.toFixed(0)}€</span></div>`;
      total += amt;
    });
    html += `<div style="border-top:2px solid white;margin-top:20px;padding-top:15px;font-size:2rem;font-weight:900;text-align:center">TOTAL VIAJE: ${total.toFixed(0)}€</div>`;
    document.getElementById('resumenFinal').innerHTML = html;
  }

  function save() {
    data.nombre = document.getElementById('nombreViaje').value;
    data.inicio = document.getElementById('fechaInicio').value;
    data.fin = document.getElementById('fechaFin').value;
    data.km = +document.getElementById('km').value || 0;
    data.precioGasoil = +document.getElementById('precioGasoil').value || 0;
    data.consumo100 = +document.getElementById('consumo100').value || 0;
    localStorage.setItem('caracolaV5', JSON.stringify(data));
  }

  // Eventos slider
  document.getElementById('slider').addEventListener('input', function(){
    const v = this.value;
    document.getElementById('sliderInput').value = v;
    document.getElementById('editValue').textContent = v + '€';
    document.getElementById('totalCat').textContent = (v * data.days).toFixed(0);
  });
  document.getElementById('sliderInput').addEventListener('input', function(){
    let v = +this.value;
    if (v > 200) v = 200;
    if (v < 0) v = 0;
    document.getElementById('slider').value = v;
    document.getElementById('editValue').textContent = v + '€';
    document.getElementById('totalCat').textContent = (v * data.days).toFixed(0);
  });

  document.getElementById('copy').onclick = ()=>{
    let texto = `${data.nombre||'Viaje'}\n${data.inicio} → ${data.fin} (${data.days} días)\n\n`;
    let total = 0;
    data.items.forEach(it=>{
      const amt = it.fixed ? it.amount : it.amountPerDay * data.days;
      texto += `${it.name}: ${amt.toFixed(0)}€\n`;
      total += amt;
    });
    texto += `\nTOTAL: ${total.toFixed(0)}€`;
    navigator.clipboard.writeText(texto).then(()=>alert('¡Resumen copiado!'));
  };

  // Iniciar
  document.getElementById('nombreViaje').value = data.nombre;
  document.getElementById('fechaInicio').value = data.inicio;
  document.getElementById('fechaFin').value = data.fin;
  document.getElementById('km').value = data.km;
  document.getElementById('precioGasoil').value = data.precioGasoil;
  document.getElementById('consumo100').value = data.consumo100;

  ['fechaInicio','fechaFin'].forEach(id=>document.getElementById(id).addEventListener('change',calcDias));
  ['km','precioGasoil','consumo100'].forEach(id=>document.getElementById(id).addEventListener('input',calcGasoil));
  document.getElementById('nombreViaje').addEventListener('input',save);

  calcDias();
  calcGasoil();
</script>
</body>
</html>
